<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../paper-input/paper-input.html" />

<!--
Element providing solution to the shortcomings of the Polymer/paper-input.

##### Example

    <pl-input></pl-input>

@element pl-input
@blurb Element providing solution to the shortcomings of the Polymer/paper-input.
@status alpha
@extends paper-input
@homepage http://polymerlabs.github.io/pl-input
-->
<polymer-element name="pl-input" extends="paper-input" attributes="required validation inline read empty" on-change="{{ startValidation }}" on-input="{{ checkRequired }}">

  <template>
    <link rel="stylesheet" href="pl-input.css" />
	<template bind if="{{ read }}">
	  <div id="read" fit layout horizontal center>
		<div class="mirror" aria-hidden>{{ value }}</div>
		<label for="{{ id }}" on-tap="{{ focus('me') }}">Edit</label>
	  </div>
	</template>
	<shadow></shadow>
  </template>

  <script>
	
    Polymer({

	  focus: function(id) {
		console.log(id);
	  },
	  
	  validateImmediately: false,
	  get required() {
	    if (this.constructor == HTMLElement && (this.getAttribute('required') || this.getAttribute('required') == '')) {
	      return this.required || 1;
	    }
	    return 0;
	  },


	  read: false,

	  get empty() {
		if (this.constructor == HTMLElement) {
		  return this.getAttribute('empty') != null;
		}
	  },
	  
	  validationChanged: function() {
		  this.startValidation();
	  },

	  ready: function() {
		this.super(arguments);
		this.setEmpty(null,this.value);
	  },
	  
	  setEmpty: function(e,v) {
		if (!v) {
		  this.setAttribute('empty','');
		}
		else {
		  this.removeAttribute('empty');
		}
	  },
	  
	  valueChanged: function(e,v) {
		this.super(arguments);
		this.setEmpty(e,v);
	  },
	  
	  /**
       * The validation attribute turns validation on or off. If `true`, validation begins `on-change`, unless `validateImmediately` is `true`.
       *
       * @attribute validation
       * @type boolean
       * @default true
       */
	  validation: true,
	
      /**
       * The `author` attribute sets an initial author
       *
       * @attribute author
       * @type string
       * @default 'Daniel Gleckler'
       */
      get author() { return 'Daniel Gleckler' },

	  startValidation: function(e) {
		if (this.validation) {
	      this.checkValidity();
	      this.setAttribute('validateImmediately',true);
		}
	  },
	  checkRequired: function(e) {
	
	    if (typeof this.required == 'string' && this.inputValue == '') {
	      // Set the appropriate error message and mark invalid for being empty
          this.shadowRoots['paper-input'].querySelector('.error-text').innerText = this.required || this.error || 'This field is required.';
	      this.setCustomValidity(true);
	    }
	    else {
      	  // Reset the error message and mark valid. This will not supress other validation failures
	      this.shadowRoots['paper-input'].querySelector('.error-text').innerText = this.error;
	      if (this.validateImmediately) this.setCustomValidity();
	    }
	  }

    });
	
  </script>

</polymer-element>

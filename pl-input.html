<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../paper-input/paper-input.html" />

<!--
Element providing solution to the shortcomings of the Polymer/paper-input.

##### Example

    <pl-input></pl-input>

@element pl-input
@blurb Element providing solution to the shortcomings of the Polymer/paper-input.
@status alpha
@homepage http://polymerlabs.github.io/pl-input
-->
<polymer-element name="pl-input" extends="paper-input" attributes="required" on-change="{{ startValidation }}" on-input="{{ checkRequired }}">

  <template>
    <link rel="stylesheet" href="pl-input.css" />
	<shadow></shadow>
  </template>

  <script>
	
    Polymer({
	  validateImmediately: false,
	  get required() {
	    if (this.constructor == HTMLElement && (this.getAttribute('required') || this.getAttribute('required') == '')) {
	      return this.required || 1;
	    }
	    return 0;
	},
	
      /**
       * The `author` attribute sets an initial author
       *
       * @attribute author
       * @type string
       * @default 'Dimitri Glazkov'
       */
      author: 'Dimitri Glazkov',

      /**
       * `fancy` is a property that does something fancy.
       *
       * @property fancy
       * @type bool
       * @default false
       */
      fancy: false,
	
      /**
       * The `sayHello` method will return a greeting.
       *
       * @method sayHello
       * @param {String} greeting Pass in a specific greeting.
       * @return {String} Returns a string greeting.
       */
      sayHello: function(greeting) {
        var response = greeting || 'Hello World!';
        return 'pl-input says, ' + response;
      },

      /**
       * The `pl-input-lasers-success` event is fired whenever we
       * call fireLasers.
       *
       * @event pl-input-lasers-success
       * @param {Object} detail
       *   @param {string} detail.sound An amazing sound.
       */

      /**
       * The `fireLasers` method will fire the lasers. At least
       * it will dispatch an event that claims lasers were fired :)
       *
       * @method fireLasers
       */
      fireLasers: function() {
        this.fire('pl-input-lasers-success', { sound: 'Pew pew pew!' });
      },

	  startValidation: function(e) {
	    this.checkValidity();
	    this.setAttribute('validateImmediately',true);
	  },
	  checkRequired: function(e) {
	
	    if (typeof this.required == 'string' && this.inputValue == '') {
	      // Set the appropriate error message and mark invalid for being empty
          this.shadowRoots['paper-input'].querySelector('.error-text').innerText = this.required || this.error || 'This field is required.';
	      this.setCustomValidity(true);
	    }
	    else {
      	  // Reset the error message and mark valid. This will not supress other validation failures
	      this.shadowRoots['paper-input'].querySelector('.error-text').innerText = this.error;
	      if (this.validateImmediately) this.setCustomValidity();
	    }
	  }

    });
	
  </script>

</polymer-element>
